{"name":"Cssy","tagline":"","body":"# cssy [![Build Status](https://secure.travis-ci.org/nodys/cssy.png?branch=master)](http://travis-ci.org/nodys/cssy) [![NPM version](https://badge-me.herokuapp.com/api/npm/cssy.png)](http://badges.enytc.com/for/npm/cssy)\r\n\r\n> A browserify transform for css (with vitamins): Use css sources **like any other module** but **without forgo** the benefits of **pre-processing** and **live source reload**.\r\n\r\n```javascript\r\nvar myCss = require('foo/my.css')\r\nmyCss()                           // Inject the css in document\r\nmyCss(elsewhere)                  // To inject css elsewhere\r\nmyCss(elsewhere, 'tv')            // Media query...\r\nmyCss.update('h1 { }')            // Update source for all injected instances\r\nmyCss.onChange(function(css) { }) // Watch for change (hey, you like live source reload ?)\r\nconsole.log('Source: %s', myCss)  // Use as a string\r\n```\r\n\r\nSee [cssy, htmly and lrio exemple](./exemples)\r\n\r\n## Features\r\n\r\n- **Require css as any other commonjs module**: `require('foo/common.css')`.\r\n- **Pre/post processing**: Cssy is framework-agnostic:\r\n  - Use any  [post/pre-processor](https://developer.chrome.com/devtools/docs/css-preprocessors) you like ([rework](https://github.com/reworkcss/rework), [postcss](https://github.com/postcss/postcss),  [less](http://lesscss.org/), [sass](http://sass-lang.com/), etc.)\r\n  - At package level, you encapsulate your *css secret cooking* and export only standard css.\r\n  - At application level you can do **global processing** for things like global `url()` rebasing.\r\n- **A nice API to read, insert, update or remove**: Use the exported css wherever you want and as you like.\r\n- **@import**: If enabled, the css at-rule [@import](https://developer.mozilla.org/en-US/docs/Web/CSS/@import) `require()` and inject another css module for you.\r\n- **Source map**: If enabled, cssy inject a [source map](https://developer.chrome.com/devtools/docs/css-preprocessors).\r\n- **Live source reload**: Provide a simple http(s) server hook reload seamlessly css source in development environnement.\r\n- **Regex filter**: Configurable, you can apply cssy's transform selectively\r\n- **Plugin**: Use [cssy as a plugin](#cssy-plugin) at application level to configure cssy finely\r\n- **Remedy**: Enable [cssy remedy](#remedy) to handle package that does not export css as commonjs module\r\n\r\nWant a nice cocktail recipe ? Use **source map** in combination with cssy's **live source reload feature** and chrome's [in-browser edition](https://developer.chrome.com/devtools/docs/workspaces).\r\n\r\n\r\n## Installation\r\n\r\n```bash\r\nnpm install --save cssy\r\n```\r\n\r\n**Then add cssy transform to your `package.json`**. Encapsulate your css processing logic inside your package: use [browserify.transform field](https://github.com/substack/browserify-handbook#browserifytransform-field).\r\n\r\n```javascript\r\n{\r\n  // ...\r\n  \"browserify\": { \"transform\": [ \"cssy\" ] ] }\r\n}\r\n```\r\n\r\n## Options\r\n\r\nIn you `package.json` you can add some options for the current package (`[ \"cssy\", {  /* options */ } ]`)\r\n\r\n- `parser` **{Array|String}**: One or many path to module that export a [parser](#parser)\r\n- `processor` **{Array|String}**: One or many path to module that export a [Css processor](#processor)\r\n- `import` **{Boolean}**: Allow [@import](#import-css) behavior (default: true)\r\n- `match` **{String|Array}**: Filter which file cssy must handle. See [Regex filter](#regex-filter)\r\n\r\nPath inside `parser` and `processor` options are either relative to package.json or npm package.\r\n\r\n\r\n**Example:**\r\n\r\n```javascript\r\n\r\n  // ...\r\n  \"browserify\": { \"transform\": [\r\n    [ \"cssy\",\r\n      {  \r\n        \"parser\"   : [\r\n          \"./mySassParser\",\r\n          \"./myLessParser\"\r\n        ],\r\n        \"processor\": \"./support/myCssProcessor\",\r\n        \"import\"   : false,\r\n        \"match\"    : [\"\\\\.(css|mycss)$\",i]\r\n      }\r\n    ]\r\n  ]}\r\n\r\n```\r\n\r\n## Global configuration\r\n\r\nAt *application level* you can change some *global* cssy behaviors\r\n\r\n```javascript\r\nvar cssy = require('cssy')\r\ncssy.config({\r\n  // Enable css minification (default: false)\r\n  minify:  false,\r\n  // Enable source map in the generated source (default: true)\r\n  sourcemap: true\r\n})\r\n```\r\n\r\n*Css minification is done with [CSSWring](https://github.com/hail2u/node-csswring). Feel free to use another one inside a [global post-processor](#global-prepost-processor).*\r\n\r\n## Internal workflow\r\n\r\n1. **Parser** Cssy try each [parser](#parser) to transform any kind of source to css (from stylus, less, sass, etc.) with a source map.\r\n2. **Global pre-processor**: Cssy call each [Global pre-processor](#global-prepost-processor)\r\n3. **processor**: Cssy call each [local processor](#processor)\r\n4. **Global post-processor**: Cssy call each [Global post-processor](#global-prepost-processor)\r\n4. **@import**: If enable cssy extract `@import` at-rules (see [Import css](#import-css))\r\n4. **minify**: If enable cssy minify css source\r\n4. **source map**: If enable cssy add the source-map\r\n4. **live reload**: If enable cssy add live source reload client to the generated bundle\r\n\r\n## Context object\r\n\r\nEach function that transform a css source ([parser](#parser), [global pre/post processor](#global-prepost-processor), [processor](#processor)), receive a **context object**:\r\n\r\n  - `src` **{String}**: Css source\r\n  - `filename` **{String}**: Css source filepath (relative to `process.cwd()`)\r\n  - `config` **{Object}**: The cssy's [transform configuration](https://github.com/substack/browserify-handbook#configuring-transforms)\r\n  - `map` **{Object}**: The [css source map](https://www.google.com/search?q=Source+Map+Revision+3+proposal) (undefined for the [parsers](#parser): as they must provide it)\r\n\r\n## Functions\r\n\r\nEach function used in cssy ([parser](#parser), [global pre/post processor](#global-prepost-processor), [processor](#processor)) use the same API and **may be asynchronous or synchronous**.\r\n\r\n```javascript\r\n\r\n// Asynchronous parser, processor, pre/post processor:\r\nmodule.exports = function (ctx, done) {\r\n  // ... change the ctx object ...\r\n\r\n  // Return ctx\r\n  done(null, ctx)\r\n\r\n  // Or if something wrong happened\r\n  done(new Error('oups...'))\r\n}\r\n\r\n// Synchronous parser, processor, pre/post processor:\r\nmodule.exports = function (ctx) {\r\n  // ... change the ctx object ...\r\n  return ctx;\r\n}\r\n```\r\n\r\n## Css meta-language: sass, stylus, less, ...\r\n\r\nCssy provide [parsers for common css meta-languages](./src/parsers). But, cssy does not depend on them so you can install only what you use, and control version according to you needs. For instance, to use less sources with cssy, add [less](https://www.npmjs.org/package/less) to your package dependencies (`npm install --save less`).\r\n\r\nIf you need something more specific, you may add your own parser.\r\n\r\n## Parser\r\n\r\nParser's job is to read a source from any format (sass, stylus, less, *whatever*), and to return a **css source** and a **source-map**.\r\n\r\n- Parsers use the [same api](#functions) than any other function used in cssy\r\n- See [options.parser](#options) to add your own parser before cssy's parsers\r\n- See [cssy's parsers for common css meta-languages](./src/parsers) as example.\r\n- Parser are executed in series, until one return a context with a source-map.\r\n\r\n## Processor\r\n\r\nFor cssy, a *processor* is an function that transform a [cssy context object](#cssy-context-object) to another [cssy context object](#cssy-context-object). Like for [browserify's transform](https://github.com/substack/node-browserify#btransformopts-tr) cssy processor are applied **only on the sources of the current package**. (See too [Global pre/post processor](#Global pre/post processor))\r\n\r\n\r\n- Parsers use the [same api](#functions) than any other function used in cssy\r\n- See [options.processor](#options) to add one or many processor\r\n\r\n### Processor example\r\nHere with [postcss](https://github.com/postcss/postcss) but you can use any other library (Preferably with good source-map support)\r\n\r\n```javascript\r\nvar autoprefixer     = require('autoprefixer');\r\nvar postcssCalc      = require('postcss-calc');\r\nvar customProperties = require(\"postcss-custom-properties\")\r\nvar postcss          = require('postcss');\r\n\r\nmodule.exports = function(ctx, done) {\r\n  var result = postcss()\r\n    .use(customProperties())\r\n    .use(postcssCalc())\r\n    .use(autoprefixer.postcss)\r\n    .process(ctx.src, {\r\n      map : { prev : ctx.map } // Preserve source map !\r\n    });\r\n\r\n  ctx.src = result.css;\r\n  ctx.map = result.map.toJSON();\r\n\r\n  done(null, ctx)\r\n}\r\n```\r\n\r\n## Global pre/post processor\r\n\r\nGlobal pre/post processor must be used only at *application level* (where you bundle your application) for things like global `url()` rebasing, optimizations for production, etc. Pre/post processor share the same api than [cssy processor](#processor).\r\n\r\n```javascript\r\nvar cssy = require('cssy')\r\n\r\n// Add one or many pre-processors\r\ncssy.pre(function(ctx, done) {\r\n  // ... Applied on every source handled by cssy\r\n})\r\n\r\n// Add one or many post-processors\r\ncssy.post(function(ctx, done) {\r\n  // ... Applied on every source handled by cssy\r\n})\r\n\r\n```\r\nSee too [use cssy plugin to add pre/post processor](#cssy-plugin)\r\n\r\n## Live source reload\r\n\r\n**Cssy provide a tiny live source reload mechanism based on websocket for development purpose only.**\r\n\r\nClassic live source reload for css usually require that all (builded) css source are accessible via an url. This is not convenient with bundled css sources that comes from anywhere in the dependency tree. And this is almost impraticable if css sources are injected somewhere else than the main document (shadow root for instance) without reloading all the page.\r\n\r\n**Just attach cssy to the http(s) server that serve the application, cssy will do the rest:** (browserify bundler must in the same process):\r\n\r\n```javascript\r\nvar http   = require('http')\r\nvar cssy   = require('cssy')\r\nvar server = http.createServer(/* your application */).listen(8080);\r\n\r\ncssy.live(server);\r\n```\r\n\r\n### Use your own file watcher\r\n\r\nTo trigger a change on a css source, just call the change listener returned by `cssy.attachServer()` :\r\n\r\n```javascript\r\nvar cssyChangeListener = cssy.attachServer(server);\r\ncssyChangeListener('path/to/source.css');\r\n```\r\n\r\nHere is an example with [chockidar](https://github.com/paulmillr/chokidar) :\r\n\r\n```javascript\r\nrequire('chokidar')\r\n  .watch('.', {ignored: /[\\/\\\\]\\./})\r\n  .on('change', cssy.attachServer(server))\r\n```\r\n\r\n## Import css\r\n\r\nUnless you set the [import option](#options) to false, `@import` [at-rules](https://developer.mozilla.org/en-US/docs/Web/CSS/At-rule) works like a `require()`.\r\n\r\nFor instance with two css file, `app.css` and `print.css`:\r\n\r\n```css\r\n/* app.css */\r\n@import \"print.css\" print;\r\nbody { /* ... */ }\r\n```\r\n\r\n```css\r\n/* print.css */\r\n.not-printable { display: none }\r\n```\r\n\r\nWhen you inject `app.css`, `print.css` will be injected too with the media query `print`\r\n\r\n## Regex filter\r\n\r\nDefault filter is all css files and most meta-css-language files: `/\\.(css|sass|scss|less|styl)$/i`. You can set the [match option](#options) to filter which file cssy must handle.\r\n\r\n`match` option is either a String or an Array used to instantiate a new [regular expression](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions):\r\n\r\n- With a string `\"\\\\.myCss$\"` become `/\\.myCss$/`\r\n- With an array, to add regular expression flags `[\"\\\\.myCss$\",\"i\"]` become `/\\.myCss$/i`\r\n\r\n\r\n```javascript\r\n{\r\n  // ... package.json ...\r\n  \"browserify\": {\r\n    \"transform\": [\r\n      // Match all *.mycss files in src/css\r\n      [ \"cssy\", {  match: [\"src\\\\/css\\\\/.*\\\\.mycss$\",\"i\"] } ]\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\n## Cssy plugin\r\n\r\nCssy can be used as a browserify plugin to set global behaviors:\r\n\r\n#### Using browserify api\r\n\r\n```javascript\r\nvar browserify = require('browserify');\r\nvar cssy       = require('cssy');\r\nvar b = browserify('./app.css')\r\nb.plugin(cssy, {\r\n  // Global configuration:\r\n  minify:    true,\r\n  sourcemap: false,\r\n\r\n  // See live source reload:\r\n  live: myHttpServerInstance,\r\n\r\n  // See pre/post processor (function or path to a processor module):\r\n  pre:  [\r\n    './myPreprocessor',\r\n    function anotherPreprocessor(ctx) { return ctx }\r\n  ],\r\n  post: 'post-processor',\r\n\r\n  // See remedy:\r\n  //   - Use current package cssy config:\r\n  remedy: true,\r\n  //   - Use set remedy config:\r\n  remedy: {\r\n    processor: './processor' // (function or path to a processor module)\r\n    match:     /css$/i,\r\n    import:    false\r\n  }\r\n})\r\n\r\n```\r\n\r\n#### Using browserify command\r\n\r\nBrowserify use [subarg](https://www.npmjs.org/package/subarg) syntaxe. See too [browserify plugin](https://github.com/substack/node-browserify#plugins)\r\n\r\n```sh\r\nbrowserify ./app.css -p [                                 \\\r\n  cssy                                                    \\\r\n    --minify                                              \\\r\n    --no-sourcemap                 # sourcemap = false    \\\r\n    --live './server.js'                                  \\\r\n    --pre  './myPreprocessor'                             \\\r\n    --pre  'another-preprocessor'  # repeat for an array  \\\r\n    --post 'post-processor'                               \\\r\n    --remedy                       # enable remedy ...    \\\r\n    --remedy [                     # ... or use subarg    \\\r\n      --processor './processor'                           \\\r\n      --no-import                                         \\\r\n      --match 'css$' --match 'i'                          \\\r\n    ]                                                     \\\r\n]\r\n```\r\n\r\n## Remedy\r\n\r\n**Cssy's remedy is a solution to use libraries that does not export their css sources as commonjs modules**\r\n\r\nBrowserify transforms are scoped to the current package, not its dependency: and that's a good thing !\r\n\r\n> *[From module-deps readme:](https://github.com/substack/module-deps#transforms)* (...) the transformations you specify will not be run for any files in node_modules/. This is because modules you include should be self-contained and not need to worry about guarding themselves against transformations that may happen upstream.\r\n\r\n**However**, if you want to use some parts of a library like [semantic-ui](https://github.com/Semantic-Org/Semantic-UI), cssy provide a solution **at application level** (where you bundle your application): the **remedy** global transform.\r\n\r\n#### Enable remedy:\r\n\r\nIf remedy options is `true` cssy will use the cssy configuration from the `package.json` closest to the current working directory :\r\n\r\n```javascript\r\n// Add remedy to a browserify instance (bundler)\r\nbundler.plugin(cssy, { remedy: true })\r\n```\r\n\r\nBut you can set specific options has described in the [cssy plugin section](#cssy-plugin)\r\n\r\n```javascript\r\n// Add remedy to a browserify instance (bundler)\r\nbundler.plugin(cssy, { remedy: { processor: 'myprocessor' } })\r\n```\r\n\r\n#### Remedy options:\r\n\r\nRemedy options are the same of [the cssy's transform options](#options).\r\n\r\n#### Symptoms indicating a need for a remedy\r\n\r\nUsually, when browserify encounter a source he can't handle correctly (such css) you see something like `SyntaxError: Unexpected token ILLEGAL`\r\n\r\n---\r\n\r\n# CssyBrowser API\r\n\r\n<!-- START CssyBrowser -->\r\n\r\n## CssyBrowser()\r\n> CssyBrowser is the object exported by a module handled by cssy:\r\n\r\n```javascript\r\nvar myCss = require('./my.css');\r\n// myCss is a CssyBrowser\r\n```\r\n\r\nA CssyBrowser instance can be used as:\r\n\r\n- **An string** when used in a context that imply a string: thanks to\r\n  `CssyBrowser.toString()` that return the css source.\r\n- **A function**, alias of CssyBrowser.insert([to, [media]]), to inject\r\n  the css source in the document: `myCss()`,\r\n  `myCss(element)` or `myCss(element, 'media query')`.\r\n- **An object** with the methods described below.\r\n\r\n**return** {`Object`}\r\nSee [CssyBrowser.insert()](#cssybrowserinsertto-media)\r\n\r\n\r\n## CssyBrowser.insert([to], [media])\r\n> Insert css source in the DOM\r\n\r\nCreate and append a `<style>` element in the dom at `to`. If the source contain\r\n`@import` at-rules, imported CssyBrowser modules are injected too.\r\nThe content of all the injected `<style>` element is binded to css source\r\nchange: When `.update()` is called by you or by the cssy's live source\r\nreload server.\r\n\r\n**Parameters:**\r\n\r\n  - **[to]** {`HTMLElement`|`ShadowRoot`}\r\n    Where to inject the style. Default to document's head.\r\n\r\n  - **[media]** {`String`}\r\n    Set the media attribute of the injected style tag\r\n\r\n**return** {`Object`}\r\nAn object with:\r\n- `element` **{HTMLElement}**: The `style` element inserted\r\n- `children` **{Array}**: The other CssyBrowser instances imported\r\n  and injected by this instance\r\n- `remove` **{Function}**: Remove injected `style` element and all\r\n  other CssyBrowser instances imported\r\n  other CssyBrowser instances imported\r\n\r\n\r\n## CssyBrowser.update(src)\r\n> Update current css source\r\n\r\nEach inject style element are updated too\r\n\r\n**Parameters:**\r\n\r\n  - **src** {`String`}\r\n\r\n\r\n\r\n## CssyBrowser.onChange(listener)\r\n> Listen for css source changes\r\n\r\n**Parameters:**\r\n\r\n  - **listener** {`Function`}\r\n    Change listener. Receive new css source\r\n    Change listener. Receive new css source\r\n\r\n\r\n## CssyBrowser.offChange(listener)\r\n> Detach change listener\r\n\r\n**Parameters:**\r\n\r\n  - **listener** {`Function`}\r\n\r\n\r\n\r\n## CssyBrowser.getImports()\r\n> Get the imported CssyBrowser instance (based on `@import` at-rules)\r\n\r\n**return** {`Array`}\r\nArray of CssyBrowser instance\r\n\r\n\r\n## CssyBrowser.toString()\r\n> Override default toString()\r\n\r\n**return** {`String`}\r\nThe current css source\r\n\r\n<!-- END CssyBrowser -->\r\n\r\n---\r\n\r\nLicense: [The MIT license](https://github.com/nodys/cssy/blob/master/LICENSE)","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}